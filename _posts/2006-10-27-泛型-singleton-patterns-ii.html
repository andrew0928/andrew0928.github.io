---
layout: post
title: "泛型 + Singleton Patterns (II)"
categories:
- ".NET"
tags: []
published: true
comments: true
---
<p><p>上篇因為貼 code , 放一起實在太長了, 只好分兩篇... 吊完胃口, 不囉唆了, 直接看我想出來的解法. 原則還是跟一般的函式庫一樣, 我希望先做出一個 base class, 把 singleton 的實作細節都處理掉, 函式庫的目的是讓使用你 lib 的人會很快樂才對, 因此 base class 可以辛苦點沒關係, 但是絕不能讓用你 code 的人得做苦工...</p>
<p>好了, 我實做出來的版本, code 如下:</p>
<div class="code">
<div style="FONT-SIZE: 12pt; BACKGROUND: white; COLOR: black; FONT-FAMILY: fixedsys">
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;&nbsp;7</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="COLOR: blue">public</span> <span style="COLOR: blue">class</span> <span style="COLOR: teal">GenericSingletonBase</span>&lt;T&gt;</p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;&nbsp;8</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="COLOR: blue">where</span> T: <span style="COLOR: teal">GenericSingletonBase</span>&lt;T&gt;,</p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;&nbsp;9</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="COLOR: blue">new</span>()</p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;10</span>&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;11</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="COLOR: blue">public</span> <span style="COLOR: blue">readonly</span> <span style="COLOR: blue">static</span> T Instance = <span style="COLOR: blue">new</span> T();</p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;12</span>&nbsp;&nbsp;&nbsp;&nbsp; }</p></div></div>
<p>沒看錯, 就是只有這幾行...&nbsp;接下來貼的 code 是, 如果我自己要實作 singleton pattern 的 class 時, 該如何來用這個 lib:</p>
<div class="code">
<div style="FONT-SIZE: 12pt; BACKGROUND: white; COLOR: black; FONT-FAMILY: fixedsys">
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;14</span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="COLOR: blue">public</span> <span style="COLOR: blue">class</span> <span style="COLOR: teal">GenericSingletonImpl1</span></p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;15</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; : <span style="COLOR: teal">GenericSingletonBase</span>&lt;<span style="COLOR: teal">GenericSingletonImpl1</span>&gt;</p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;16</span>&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;17</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="COLOR: blue">public</span> GenericSingletonImpl1()</p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;18</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; : <span style="COLOR: blue">base</span>()</p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;19</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;20</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="COLOR: teal">Console</span>.WriteLine(<span style="COLOR: maroon">"GenericSingletonImpl1.ctor()"</span>);</p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;21</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;22</span>&nbsp;&nbsp;&nbsp;&nbsp; }</p></div></div>
<p>扣掉非必要的 constructor, 其實 class 繼承的部份寫完, 就沒有其它必要的 code 了, 很好, 又滿足了我一個要求... </p>
<p>再來就剩最後一個, 要用這個 class 的 code 會不會像上一篇的例子一樣醜? 每次都要自己 casting ? 再看一下 code ...</p>
<div class="code">
<div style="FONT-SIZE: 12pt; BACKGROUND: white; COLOR: black; FONT-FAMILY: fixedsys">
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;21</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="COLOR: teal">GenericSingletonImpl1</span> o1 = <span style="COLOR: teal">GenericSingletonImpl1</span>.Instance;</p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;22</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="COLOR: teal">GenericSingletonImpl1</span> o2 = <span style="COLOR: teal">GenericSingletonImpl1</span>.Instance;</p>
<p style="MARGIN: 0px"><span style="COLOR: #2b91af">&nbsp;&nbsp;&nbsp;23</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="COLOR: teal">GenericSingletonImpl1</span> o3 = <span style="COLOR: teal">GenericSingletonImpl1</span>.Instance;</p></div></div>
<p>很好, 收工... 哈哈... 謝謝大家的收看 [:D]</p></p>
